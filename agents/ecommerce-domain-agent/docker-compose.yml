version: '3.8'

services:
  service:
    build: ./service
    ports:
      - "9002:9002"
      - "8082:8082"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-test-key}
      - WEAVIATE_URL=http://weaviate:8080
      - TEST_DATA_AGENT_HOST=host.docker.internal
      - TEST_DATA_AGENT_PORT=9091
      - LOG_LEVEL=INFO
    depends_on:
      - weaviate
    networks:
      - qa-platform
    volumes:
      - ./service:/app:ro  # Mount source code for development

  weaviate:
    image: semitechnologies/weaviate:1.24.1
    ports:
      - "8090:8080"
      - "50061:50051"
    environment:
      - QUERY_DEFAULTS_LIMIT=25
      - AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED=true
      - PERSISTENCE_DATA_PATH=/var/lib/weaviate
      - DEFAULT_VECTORIZER_MODULE=none
      - ENABLE_MODULES=""
      - CLUSTER_HOSTNAME=node1
    volumes:
      - weaviate_data:/var/lib/weaviate
    networks:
      - qa-platform

networks:
  qa-platform:
    name: qa-platform
    driver: bridge

volumes:
  weaviate_data: